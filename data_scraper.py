#! python3

# build a web scraper for the entire hessol fuel db
# Source: 
# https://www.benzinpreis-aktuell.de/historische-spritpreise-9e45bfcc41ff73dd0e9b1fea64bd4346

# just run it pure with python3 data_scrapper.py
# maximum precision is hourly. but that is fine.

import requests
import bs4
import csv
target_date = ['21062021', '20062021', '19062021', '18062021', '17062021', '16062021', '15062021', '14062021', '13062021', '12062021', '11062021', '10062021', '09062021', '08062021', '07062021', '06062021', '05062021', '04062021', '03062021', '02062021', '01062021', '31052021', '30052021', '29052021', '28052021', '27052021', '26052021', '25052021', '24052021', '23052021', '22052021', '21052021', '20052021', '19052021', '18052021', '17052021', '16052021', '15052021', '14052021', '13052021', '12052021', '11052021', '10052021', '09052021', '08052021', '07052021', '06052021', '05052021', '04052021', '03052021', '02052021', '01052021', '30042021', '29042021', '28042021', '27042021', '26042021', '25042021', '24042021', '23042021', '22042021', '21042021', '20042021', '19042021', '18042021', '17042021', '16042021', '15042021', '14042021', '13042021', '12042021', '11042021', '10042021', '09042021', '08042021', '07042021', '06042021', '05042021', '04042021', '03042021', '02042021', '01042021', '31032021', '30032021', '29032021', '28032021', '27032021', '26032021', '25032021', '24032021', '23032021', '22032021', '21032021', '20032021', '19032021', '18032021', '17032021', '16032021', '15032021', '14032021', '13032021', '12032021', '11032021', '10032021', '09032021', '08032021', '07032021', '06032021', '05032021', '04032021', '03032021', '02032021', '01032021', '28022021', '27022021', '26022021', '25022021', '24022021', '23022021', '22022021', '21022021', '20022021', '19022021', '18022021', '17022021', '16022021', '15022021', '14022021', '13022021', '12022021', '11022021', '10022021', '09022021', '08022021', '07022021', '06022021', '05022021', '04022021', '03022021', '02022021', '01022021', '31012021', '30012021', '29012021', '28012021', '27012021', '26012021', '25012021', '24012021', '23012021', '22012021', '21012021', '20012021', '19012021', '18012021', '17012021', '16012021', '15012021', '14012021', '13012021', '12012021', '11012021', '10012021', '09012021', '08012021', '07012021', '06012021', '05012021', '04012021', '03012021', '02012021', '01012021', '31122020', '30122020', '29122020', '28122020', '27122020', '26122020', '25122020', '24122020', '23122020', '22122020', '21122020', '20122020', '19122020', '18122020', '17122020', '16122020', '15122020', '14122020', '13122020', '12122020', '11122020', '10122020', '09122020', '08122020', '07122020', '06122020', '05122020', '04122020', '03122020', '02122020', '01122020', '30112020', '29112020', '28112020', '27112020', '26112020', '25112020', '24112020', '23112020', '22112020', '21112020', '20112020', '19112020', '18112020', '17112020', '16112020', '15112020', '14112020', '13112020', '12112020', '11112020', '10112020', '09112020', '08112020', '07112020', '06112020', '05112020', '04112020', '03112020', '02112020', '01112020', '31102020', '30102020', '29102020', '28102020', '27102020', '26102020', '25102020', '24102020', '23102020', '22102020', '21102020', '20102020', '19102020', '18102020', '17102020', '16102020', '15102020', '14102020', '13102020', '12102020', '11102020', '10102020', '09102020', '08102020', '07102020', '06102020', '05102020', '04102020', '03102020', '02102020', '01102020', '30092020', '29092020', '28092020', '27092020', '26092020', '25092020', '24092020', '23092020', '22092020', '21092020', '20092020', '19092020', '18092020', '17092020', '16092020', '15092020', '14092020', '13092020', '12092020', '11092020', '10092020', '09092020', '08092020', '07092020', '06092020', '05092020', '04092020', '03092020', '02092020', '01092020', '31082020', '30082020', '29082020', '28082020', '27082020', '26082020', '25082020', '24082020', '23082020', '22082020', '21082020', '20082020', '19082020', '18082020', '17082020', '16082020', '15082020', '14082020', '13082020', '12082020', '11082020', '10082020', '09082020', '08082020', '07082020', '06082020', '05082020', '04082020', '03082020', '02082020', '01082020', '31072020', '30072020', '29072020', '28072020', '27072020', '26072020', '25072020', '24072020', '23072020', '22072020', '21072020', '20072020', '19072020', '18072020', '17072020', '16072020', '15072020', '14072020', '13072020', '12072020', '11072020', '10072020', '09072020', '08072020', '07072020', '06072020', '05072020', '04072020', '03072020', '02072020', '01072020', '30062020', '29062020', '28062020', '27062020', '26062020', '25062020', '24062020', '23062020', '22062020', '21062020', '20062020', '19062020', '18062020', '17062020', '16062020', '15062020', '14062020', '13062020', '12062020', '11062020', '10062020', '09062020', '08062020', '07062020', '06062020', '05062020', '04062020', '03062020', '02062020', '01062020', '31052020', '30052020', '29052020', '28052020', '27052020', '26052020', '25052020', '24052020', '23052020', '22052020', '21052020', '20052020', '19052020', '18052020', '17052020', '16052020', '15052020', '14052020', '13052020', '12052020', '11052020', '10052020', '09052020', '08052020', '07052020', '06052020', '05052020', '04052020', '03052020', '02052020', '01052020', '30042020', '29042020', '28042020', '27042020', '26042020', '25042020', '24042020', '23042020', '22042020', '21042020', '20042020', '19042020', '18042020', '17042020', '16042020', '15042020', '14042020', '13042020', '12042020', '11042020', '10042020', '09042020', '08042020', '07042020', '06042020', '05042020', '04042020', '03042020', '02042020', '01042020', '31032020', '30032020', '29032020', '28032020', '27032020', '26032020', '25032020', '24032020', '23032020', '22032020', '21032020', '20032020', '19032020', '18032020', '17032020', '16032020', '15032020', '14032020', '13032020', '12032020', '11032020', '10032020', '09032020', '08032020', '07032020', '06032020', '05032020', '04032020', '03032020', '02032020', '01032020', '29022020', '28022020', '27022020', '26022020', '25022020', '24022020', '23022020', '22022020', '21022020', '20022020', '19022020', '18022020', '17022020', '16022020', '15022020', '14022020', '13022020', '12022020', '11022020', '10022020', '09022020', '08022020', '07022020', '06022020', '05022020', '04022020', '03022020', '02022020', '01022020', '31012020', '30012020', '29012020', '28012020', '27012020', '26012020', '25012020', '24012020', '23012020', '22012020', '21012020', '20012020', '19012020', '18012020', '17012020', '16012020', '15012020', '14012020', '13012020', '12012020', '11012020', '10012020', '09012020', '08012020', '07012020', '06012020', '05012020', '04012020', '03012020', '02012020', '01012020', '31122019', '30122019', '29122019', '28122019', '27122019', '26122019', '25122019', '24122019', '23122019', '22122019', '21122019', '20122019', '19122019', '18122019', '17122019', '16122019', '15122019', '14122019', '13122019', '12122019', '11122019', '10122019', '09122019', '08122019', '07122019', '06122019', '05122019', '04122019', '03122019', '02122019', '01122019', '30112019', '29112019', '28112019', '27112019', '26112019', '25112019', '24112019', '23112019', '22112019', '21112019', '20112019', '19112019', '18112019', '17112019', '16112019', '15112019', '14112019', '13112019', '12112019', '11112019', '10112019', '09112019', '08112019', '07112019', '06112019', '05112019', '04112019', '03112019', '02112019', '01112019', '31102019', '30102019', '29102019', '28102019', '27102019', '26102019', '25102019', '24102019', '23102019', '22102019', '21102019', '20102019', '19102019', '18102019', '17102019', '16102019', '15102019', '14102019', '13102019', '12102019', '11102019', '10102019', '09102019', '08102019', '07102019', '06102019', '05102019', '04102019', '03102019', '02102019', '01102019', '30092019', '29092019', '28092019', '27092019', '26092019', '25092019', '24092019', '23092019', '22092019', '21092019', '20092019', '19092019', '18092019', '17092019', '16092019', '15092019', '14092019', '13092019', '12092019', '11092019', '10092019', '09092019', '08092019', '07092019', '06092019', '05092019', '04092019', '03092019', '02092019', '01092019', '31082019', '30082019', '29082019', '28082019', '27082019', '26082019', '25082019', '24082019', '23082019', '22082019', '21082019', '20082019', '19082019', '18082019', '17082019', '16082019', '15082019', '14082019', '13082019', '12082019', '11082019', '10082019', '09082019', '08082019', '07082019', '06082019', '05082019', '04082019', '03082019', '02082019', '01082019', '31072019', '30072019', '29072019', '28072019', '27072019', '26072019', '25072019', '24072019', '23072019', '22072019', '21072019', '20072019', '19072019', '18072019', '17072019', '16072019', '15072019', '14072019', '13072019', '12072019', '11072019', '10072019', '09072019', '08072019', '07072019', '06072019', '05072019', '04072019', '03072019', '02072019', '01072019', '30062019', '29062019', '28062019', '27062019', '26062019', '25062019', '24062019', '23062019', '22062019', '21062019', '20062019', '19062019', '18062019', '17062019', '16062019', '15062019', '14062019', '13062019', '12062019', '11062019', '10062019', '09062019', '08062019', '07062019', '06062019', '05062019', '04062019', '03062019', '02062019', '01062019', '31052019', '30052019', '29052019', '28052019', '27052019', '26052019', '25052019']



def scrapper(target_date, value):
	value += 1
	url_date = target_date[:4]
	url_date = url_date[:2] + '.' + url_date[2:4]
	current_page = requests.get('https://www.benzinpreis-aktuell.de/die-spritpreise-vom-' + url_date + '.2021-station-9e45bfcc41ff73dd0e9b1fea64bd4346')
	pageSoup = bs4.BeautifulSoup(current_page.text, 'html.parser')
	relevant_info_even = pageSoup.findAll('tr', {'class': 'trc trc0'})
	relevant_info_odd = pageSoup.findAll('tr', {'class': 'trc trc1'})

	mylistodd = list()
	mylisteven = list()

	for item in relevant_info_odd:
		mylistodd.append(item.getText())

	for item in relevant_info_even:
		mylisteven.append(item.getText())

	# 4 lists for date time petrol diesel
	datex = list()
	timex = list()
	petrolx = list()
	dieselx = list()

	datey = list()
	timey = list()
	petroly = list()
	diesely = list()


	for item in mylisteven:
		datex.append(item[1:9])
		timex.append(item[11:16])
		petrolx.append(item[17:22])
		dieselx.append(item[23:28])


	for item in mylistodd:
		datey.append(item[1:9])
		timey.append(item[11:16])
		petroly.append(item[17:22])
		diesely.append(item[23:28])


	date = list()
	time = list()
	petrol = list()
	diesel = list()

	for i in range(len(datex)):
		for j in range(2):
			if j == 0:
				date.append(datex[i])
				time.append(timex[i])
				petrol.append(petrolx[i])
				diesel.append(dieselx[i])

			else:
				date.append(datey[i])
				time.append(timey[i])
				petrol.append(petroly[i])
				diesel.append(diesely[i])



	with open('db_' + target_date + '.csv', 'a', newline='') as new_file:
			csv_writer = csv.writer(new_file)

			for i in range(len(date)):
				line = [date[i], time[i], petrol[i], diesel[i]]
				csv_writer.writerow(line)
	print(value)
	return "[SUCESS] "


for i in range(len(target_date)):
	print(scrapper(target_date[i], 0))
